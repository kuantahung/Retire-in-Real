<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retire in REAL - 退休規劃報告</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@600;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #0f2c4e; /* 深海軍藍 */
            --accent-color: #c5a065;  /* 香檳金 */
            --text-color: #333333;
            --light-bg: #f4f6f9;
        }

        body { font-family: 'Noto Sans TC', sans-serif; background-color: #eef1f5; color: var(--text-color); }
        h1, h2, h3, h4, h5 { font-family: 'Noto Serif TC', serif; }
        
        /* === 螢幕顯示樣式 === */
        .web-view-card { border: none; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); background: white; margin-bottom: 20px; }
        .web-header { background: linear-gradient(135deg, var(--primary-color), #2a5298); color: white; padding: 20px; border-radius: 12px; margin-bottom: 25px; }
        .input-group-text { background-color: #e9ecef; }
        .ref-badge { font-size: 0.75rem; color: #666; background-color: #fff3cd; padding: 2px 8px; border-radius: 4px; border: 1px solid #ffecb5; margin-top: 5px; display: inline-block; }
        
        #print-report-container { display: none; }

        /* === 列印專用樣式 (A4 Landscape - 強制單頁) === */
        @media print {
            @page { size: A4 landscape; margin: 0; }
            
            body { 
                background-color: white; 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
                margin: 0;
                padding: 0;
                width: 297mm;
                height: 210mm;
                overflow: hidden;
            }
            
            .web-interface, .no-print, .btn, .input-group-text { display: none !important; }
            
            #print-report-container { 
                display: flex;
                flex-direction: column;
                width: 100%; 
                height: 100%; 
                box-sizing: border-box; 
                padding: 10mm 12mm;
                background: white;
            }

            /* 頁首 */
            .report-header { 
                flex: 0 0 auto;
                display: flex; 
                justify-content: space-between; 
                align-items: center;
                border-bottom: 2px solid var(--accent-color); 
                padding-bottom: 8px; 
                margin-bottom: 12px; 
            }
            .report-title { color: var(--primary-color); font-size: 24pt; font-weight: 900; margin: 0; letter-spacing: -1px; line-height: 1; }
            .report-subtitle { color: #666; font-size: 9pt; letter-spacing: 2px; text-transform: uppercase; margin-top: 4px; }
            .client-badge { 
                background-color: var(--light-bg); 
                padding: 6px 15px; 
                border-radius: 6px; 
                text-align: right; 
                border-left: 5px solid var(--primary-color);
            }
            .client-name { font-size: 14pt; font-weight: bold; color: var(--primary-color); line-height: 1.2; }
            .report-meta { font-size: 9pt; color: #888; margin-top: 2px; }

            /* 主內容區 Grid */
            .report-content-wrapper {
                flex: 1 1 auto;
                display: grid;
                grid-template-columns: 25% 45% 26%;
                gap: 15px;
                overflow: hidden;
            }

            .rpt-col { 
                display: flex; 
                flex-direction: column; 
                justify-content: flex-start;
                gap: 15px; 
                height: 100%;
            }

            .rpt-card { 
                border: 1px solid #e0e0e0; 
                border-radius: 8px; 
                padding: 12px; 
                background-color: #fff;
                display: flex;
                flex-direction: column;
            }
            .rpt-col.middle .rpt-card { flex: 1; }

            .rpt-card-header {
                font-family: 'Noto Serif TC', serif;
                color: var(--primary-color);
                font-size: 11pt;
                font-weight: bold;
                border-bottom: 2px solid #f0f0f0;
                padding-bottom: 6px;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                flex: 0 0 auto;
            }
            .rpt-card-header i { margin-right: 8px; color: var(--accent-color); }

            /* 左欄 KPI */
            .kpi-box { 
                background-color: var(--light-bg); 
                text-align: center; 
                padding: 12px 5px; 
                border-radius: 6px; 
                margin-bottom: 10px;
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            .kpi-title { font-size: 8pt; color: #666; text-transform: uppercase; }
            .kpi-num { font-size: 20pt; font-weight: 900; color: var(--primary-color); line-height: 1.2; margin: 2px 0; }
            .kpi-desc { font-size: 8pt; color: #888; }

            /* 中欄 表格 */
            .fin-table { width: 100%; font-size: 10pt; border-collapse: collapse; height: 100%; }
            .fin-table td { 
                padding: 6px 8px;
                border-bottom: 1px dashed #e0e0e0; 
                vertical-align: middle;
            }
            .fin-table tr:last-child td { border-bottom: none; }
            .fin-label { color: #444; }
            .fin-val { text-align: right; font-family: 'Consolas', monospace; font-weight: 600; font-size: 11pt; color: #000; }
            .fin-total { 
                background-color: #f8f9fa; 
                font-weight: bold; 
                color: var(--primary-color);
                border-top: 2px solid var(--primary-color);
            }
            .fin-total td { padding: 10px 8px; font-size: 11pt; }
            
            /* 右欄 缺口 */
            .gap-box {
                background: linear-gradient(135deg, #fffcf5 0%, #fff 100%);
                border: 1px solid var(--accent-color);
                text-align: center;
                padding: 15px 10px;
                border-radius: 8px;
                margin-bottom: 10px;
                flex: 0 0 auto;
            }
            .gap-label { font-size: 10pt; color: #666; margin-bottom: 5px; }
            .gap-number { font-size: 32pt; font-weight: 900; color: #dc3545; font-family: 'Noto Serif TC', serif; margin: 0; line-height: 1.1; }
            .gap-msg { font-size: 9pt; font-weight: bold; color: #555; margin-top: 5px; }
            
            /* 拖延表格 */
            .delay-card {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
            .delay-table { width: 100%; font-size: 9pt; margin-top: auto; margin-bottom: auto; }
            .delay-table th { background: #f0f0f0; padding: 6px 2px; font-size: 8.5pt; text-align: center; color: #555; }
            .delay-table td { border-bottom: 1px solid #eee; padding: 8px 2px; text-align: center; }
            .inc-text { color: #dc3545; font-weight: bold; }

            /* 頁尾 - 靠右顯示 */
            .report-footer {
                flex: 0 0 auto;
                border-top: 1px solid #ddd;
                padding-top: 6px;
                margin-top: 10px;
                font-size: 8pt;
                color: #999;
                display: flex;
                justify-content: flex-end; /* 靠右對齊 */
            }
        }
    </style>
</head>
<body>

<div class="container py-4 web-interface">
    <div class="web-header text-center">
        <h2><i class="bi bi-file-earmark-check"></i> Retire in REAL 退休規劃</h2>
        <p class="mb-0">單頁警示版：包含拖延代價百分比分析</p>
    </div>

    <div class="card p-3 shadow-sm mb-4 border-primary">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5 class="mb-1 fw-bold text-primary">生成報告</h5>
                <small class="text-muted">請確認列印設定為 <b>「橫向 (Landscape)」</b></small>
            </div>
            <button onclick="window.print()" class="btn btn-primary btn-lg shadow">
                <i class="bi bi-printer-fill"></i> 列印 / 下載 PDF
            </button>
        </div>
        <div class="mt-2 text-end text-muted small">
            <i class="bi bi-exclamation-circle"></i> 提示：務必勾選 <b>「背景圖形」</b>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="web-view-card p-4">
                <h5 class="text-secondary border-bottom pb-2 mb-3">輸入參數設定</h5>
                <form id="calcForm">
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <label class="form-label small">姓名</label>
                            <input type="text" class="form-control" id="userName" value="錢虹樺">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">性別</label>
                            <select class="form-select" id="userGender">
                                <option value="F">女</option>
                                <option value="M">男</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">生日</label>
                            <input type="date" class="form-control" id="birthDate" value="1994-06-07">
                        </div>
                         <div class="col-md-2">
                            <label class="form-label small">保險年齡</label>
                            <input type="text" class="form-control bg-light" id="currentAge" readonly>
                        </div>
                    </div>

                    <div class="row g-3 mb-3 bg-light p-3 rounded mx-0">
                        <div class="col-md-4">
                            <label class="form-label small">預計退休年齡</label>
                            <input type="number" class="form-control" id="retireAge" value="60">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small">預期壽命</label>
                            <input type="number" class="form-control" id="lifeAge" value="83">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small">預估通膨率 (%)</label>
                            <input type="number" class="form-control" id="inflation" value="2.0" step="0.1">
                            <div class="ref-badge">
                                <i class="bi bi-graph-up-arrow"></i> 參考：主計總處近30年平均CPI約 1.74%
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">退休後每月開銷 (現值)</label>
                            <div class="input-group">
                                <span class="input-group-text">基本</span>
                                <input type="number" class="form-control" id="basicExp" value="30000">
                                <span class="input-group-text">享樂</span>
                                <input type="number" class="form-control" id="funExp" value="10000">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">現有已備資產</label>
                            <input type="number" class="form-control" id="currentAssets" value="5000000">
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-12">
                            <div class="card bg-white border">
                                <div class="card-body py-2">
                                    <h6 class="card-title small fw-bold text-primary">勞保年金試算</h6>
                                    <div class="row g-2">
                                        <div class="col-4">
                                            <label class="small text-muted">平均投保薪資</label>
                                            <input type="number" class="form-control form-control-sm" id="liSalary" value="45800">
                                        </div>
                                        <div class="col-4">
                                            <label class="small text-muted">年資</label>
                                            <input type="number" class="form-control form-control-sm" id="liYears" value="36">
                                        </div>
                                        <div class="col-4">
                                            <label class="small text-muted">風險打折 (%)</label>
                                            <input type="number" class="form-control form-control-sm" id="pensionRate" value="40">
                                        </div>
                                    </div>
                                    <div class="mt-2 text-end">
                                        <small class="text-muted me-2">系統擇優計算：</small>
                                        <span class="fw-bold text-success fs-5" id="web_pension_disp">--</span>
                                        <input type="hidden" id="govPensionMonthly">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="print-report-container">
    
    <div class="report-header">
        <div>
            <h1 class="report-title">RETIREMENT ROADMAP</h1>
            <div class="report-subtitle">Personal Financial Planning</div>
        </div>
        <div class="client-badge">
            <div class="client-name"><span id="rpt_name">--</span> <small id="rpt_gender" style="font-size:0.6em; font-weight:normal"></small></div>
            <div class="report-meta">Date: <span id="rpt_date">--</span></div>
        </div>
    </div>

    <div class="report-content-wrapper">
        
        <div class="rpt-col">
            <div class="rpt-card" style="flex:1">
                <div class="rpt-card-header"><i class="bi bi-person-bounding-box"></i> 規劃參數</div>
                <div class="kpi-box">
                    <div class="kpi-title">距離退休 Years to Retire</div>
                    <div class="kpi-num"><span id="rpt_prepYears">--</span> <small style="font-size:12pt">年</small></div>
                    <div class="kpi-desc">目前 <span id="rpt_age">--</span> 歲 → <span id="rpt_retireAge">--</span> 歲</div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-title">退休生活 Duration</div>
                    <div class="kpi-num"><span id="rpt_retireYears">--</span> <small style="font-size:12pt">年</small></div>
                    <div class="kpi-desc">預期至 <span id="rpt_lifeAge">--</span> 歲</div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-title">通膨假設 Inflation</div>
                    <div class="kpi-num"><span id="rpt_inflation">--</span>%</div>
                    <div class="kpi-desc">複利效應因子</div>
                </div>
                <div style="font-size:8pt; color:#999; margin-top:10px; padding:0 5px; line-height:1.4;">
                    <i class="bi bi-info-circle"></i> 通膨參考：<br>主計總處近30年平均CPI約 1.74%
                </div>
            </div>
        </div>

        <div class="rpt-col middle">
            <div class="rpt-card">
                <div class="rpt-card-header"><i class="bi bi-graph-up-arrow"></i> 退休需求 (Needs)</div>
                <table class="fin-table">
                    <tr>
                        <td class="fin-label">每月基本生活 (現值)</td>
                        <td class="fin-val" id="rpt_basicExp">--</td>
                    </tr>
                    <tr>
                        <td class="fin-label">每月享樂生活 (現值)</td>
                        <td class="fin-val" id="rpt_funExp">--</td>
                    </tr>
                    <tr style="background:#fcfcfc">
                        <td class="fin-label" style="font-weight:bold">每月總需求 (現值)</td>
                        <td class="fin-val" id="rpt_monthlyTotal" style="font-weight:bold">--</td>
                    </tr>
                    <tr><td colspan="2" style="text-align:center; color:#999; font-size:8pt; padding:4px;">↓ 經過 <span id="rpt_prepYears_s">--</span> 年通膨複利 ↓</td></tr>
                    <tr>
                        <td class="fin-label">退休首月所需 (未來值)</td>
                        <td class="fin-val text-danger" id="rpt_futureMonthly">--</td>
                    </tr>
                    <tr class="fin-total">
                        <td>退休總應備金額 (A)</td>
                        <td class="fin-val" id="rpt_inflatedTotal">--</td>
                    </tr>
                </table>
            </div>

            <div class="rpt-card">
                <div class="rpt-card-header"><i class="bi bi-wallet2"></i> 資產供給 (Supply)</div>
                <table class="fin-table">
                    <tr>
                        <td class="fin-label">現有已備資產</td>
                        <td class="fin-val" id="rpt_assets">--</td>
                    </tr>
                    <tr>
                        <td colspan="2" style="padding-top:10px; padding-bottom:4px;">
                            <div style="font-size:9pt; font-weight:bold; color:#0f2c4e;">預估勞保年金 (擇優後)</div>
                            <div style="display:flex; justify-content:space-between; font-size:9pt; color:#666; border-left:3px solid #ddd; padding-left:10px; background:#fafafa; margin-top:2px;">
                                <span>A式(保證): <span id="rpt_formulaA"></span></span>
                                <span>B式(年資): <span id="rpt_formulaB"></span></span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="fin-label">每月可領 (風險打折 <span id="rpt_riskRate"></span>%)</td>
                        <td class="fin-val" id="rpt_realPensionMonthly">--</td>
                    </tr>
                    <tr class="fin-total">
                        <td>資產與年金總現值 (B)</td>
                        <td class="fin-val" id="rpt_pensionTotal">--</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="rpt-col">
            <div class="rpt-card">
                <div class="rpt-card-header"><i class="bi bi-bullseye"></i> 最終結論 (Conclusion)</div>
                <div class="gap-box">
                    <div class="gap-label">退休準備金缺口 / 盈餘</div>
                    <div class="gap-number" id="rpt_gapAmount">--</div>
                    <div class="gap-msg" id="rpt_gapMsg">計算中...</div>
                </div>
            </div>

            <div class="rpt-card delay-card" id="rpt_delay_section" style="display:none;">
                <div class="rpt-card-header" style="color:#dc3545"><i class="bi bi-alarm"></i> 拖延代價分析</div>
                <div style="font-size:9pt; margin-bottom:5px; text-align:center;">
                    若現在開始，每年需存：<br>
                    <span id="rpt_yearlySave" style="font-size:14pt; font-weight:bold; color:#0f2c4e; border-bottom:2px solid #c5a065">--</span> 元
                </div>
                
                <table class="delay-table">
                    <thead>
                        <tr>
                            <th>延後</th>
                            <th>年儲蓄額</th>
                            <th>增加金額</th>
                            <th>增加比例</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1年</td>
                            <td id="d_amt_1">--</td>
                            <td class="inc-text" id="d_inc_1">--</td>
                            <td class="inc-text" id="d_pct_1">--</td>
                        </tr>
                        <tr>
                            <td>2年</td>
                            <td id="d_amt_2">--</td>
                            <td class="inc-text" id="d_inc_2">--</td>
                            <td class="inc-text" id="d_pct_2">--</td>
                        </tr>
                        <tr>
                            <td>3年</td>
                            <td id="d_amt_3">--</td>
                            <td class="inc-text" id="d_inc_3">--</td>
                            <td class="inc-text" id="d_pct_3">--</td>
                        </tr>
                    </tbody>
                </table>
                <div style="font-size:8pt; color:#888; margin-top:auto; text-align:center;">*時間是投資最大的槓桿</div>
            </div>
        </div>
    </div>

    <div class="report-footer">
        <div>本報告僅供參考</div>
    </div>
</div>

<script>
    // === 核心計算邏輯 ===
    const today = new Date().toLocaleDateString();
    document.getElementById('rpt_date').innerText = today;

    function fmt(num) {
        return num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function calcAge() {
        const birthStr = document.getElementById('birthDate').value;
        if(!birthStr) return 0;
        const birth = new Date(birthStr);
        const now = new Date();
        let months = (now.getFullYear() - birth.getFullYear()) * 12 + (now.getMonth() - birth.getMonth());
        if(now.getDate() < birth.getDate()) months--;
        
        let age = Math.floor(months / 12);
        if(months % 12 >= 6) age++;
        
        document.getElementById('currentAge').value = age;
        return age;
    }

    function calcLabor() {
        const salary = parseFloat(document.getElementById('liSalary').value) || 0;
        const years = parseFloat(document.getElementById('liYears').value) || 0;
        
        const valA = (years * salary * 0.00775) + 3000;
        const valB = (years * salary * 0.0155);
        const winner = Math.max(valA, valB);
        
        document.getElementById('govPensionMonthly').value = winner;
        document.getElementById('web_pension_disp').innerText = fmt(winner);
        
        document.getElementById('rpt_formulaA').innerText = fmt(valA);
        document.getElementById('rpt_formulaB').innerText = fmt(valB);
        return winner;
    }

    function calculate() {
        document.getElementById('rpt_name').innerText = document.getElementById('userName').value;
        document.getElementById('rpt_gender').innerText = document.getElementById('userGender').value === 'F' ? '女士' : '先生';
        
        const age = calcAge();
        const liMonthly = calcLabor();

        const retireAge = parseFloat(document.getElementById('retireAge').value);
        const lifeAge = parseFloat(document.getElementById('lifeAge').value);
        const inflation = parseFloat(document.getElementById('inflation').value);
        const basicExp = parseFloat(document.getElementById('basicExp').value);
        const funExp = parseFloat(document.getElementById('funExp').value);
        const assets = parseFloat(document.getElementById('currentAssets').value);
        const riskRate = parseFloat(document.getElementById('pensionRate').value);

        const yearsToPrep = retireAge - age;
        const yearsInRetire = lifeAge - retireAge;

        document.getElementById('rpt_age').innerText = age;
        document.getElementById('rpt_retireAge').innerText = retireAge;
        document.getElementById('rpt_lifeAge').innerText = lifeAge;
        document.getElementById('rpt_prepYears').innerText = yearsToPrep > 0 ? yearsToPrep : 0;
        document.getElementById('rpt_prepYears_s').innerText = yearsToPrep > 0 ? yearsToPrep : 0;
        document.getElementById('rpt_retireYears').innerText = yearsInRetire;
        document.getElementById('rpt_inflation').innerText = inflation;
        document.getElementById('rpt_riskRate').innerText = riskRate;

        const monthlyTotal = basicExp + funExp;
        const inflationRate = inflation / 100;
        const inflationFactor = Math.pow(1 + inflationRate, yearsToPrep);
        
        const futureMonthly = monthlyTotal * inflationFactor;
        const inflatedTotal = (monthlyTotal * 12 * yearsInRetire) * inflationFactor;

        document.getElementById('rpt_basicExp').innerText = fmt(basicExp);
        document.getElementById('rpt_funExp').innerText = fmt(funExp);
        document.getElementById('rpt_monthlyTotal').innerText = fmt(monthlyTotal);
        document.getElementById('rpt_futureMonthly').innerText = fmt(futureMonthly);
        document.getElementById('rpt_inflatedTotal').innerText = fmt(inflatedTotal);

        const realMonthlyPension = liMonthly * (riskRate / 100);
        const totalPension = realMonthlyPension * 12 * yearsInRetire;
        const totalSupply = totalPension + assets;

        document.getElementById('rpt_assets').innerText = fmt(assets);
        document.getElementById('rpt_realPensionMonthly').innerText = fmt(realMonthlyPension);
        document.getElementById('rpt_pensionTotal').innerText = fmt(totalSupply);

        const gap = inflatedTotal - totalSupply;
        const gapEl = document.getElementById('rpt_gapAmount');
        const gapMsg = document.getElementById('rpt_gapMsg');
        const delaySection = document.getElementById('rpt_delay_section');

        if (gap > 0) {
            gapEl.innerText = "- " + fmt(gap);
            gapEl.style.color = "#dc3545";
            gapMsg.innerText = "尚有資金缺口，建議儘早執行儲蓄計畫";
            gapMsg.style.color = "#dc3545";
            
            const baseYearlySave = yearsToPrep > 0 ? gap / yearsToPrep : gap;
            document.getElementById('rpt_yearlySave').innerText = fmt(baseYearlySave);
            
            if(yearsToPrep > 3) {
                delaySection.style.display = 'flex';
                for(let i=1; i<=3; i++) {
                    const remain = yearsToPrep - i;
                    const newSave = gap / remain;
                    const inc = newSave - baseYearlySave;
                    const pct = (inc / baseYearlySave) * 100;
                    
                    document.getElementById(`d_amt_${i}`).innerText = fmt(newSave);
                    document.getElementById(`d_inc_${i}`).innerText = "+" + fmt(inc);
                    document.getElementById(`d_pct_${i}`).innerText = "+" + pct.toFixed(1) + "%";
                }
            } else {
                delaySection.style.display = 'none';
            }

        } else {
            gapEl.innerText = "+ " + fmt(Math.abs(gap));
            gapEl.style.color = "#198754";
            gapMsg.innerText = "恭喜！資產配置已足以應付退休需求";
            gapMsg.style.color = "#198754";
            delaySection.style.display = 'none';
        }
    }

    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('input', calculate);
        el.addEventListener('change', calculate);
    });

    calculate();
</script>

</body>
</html>
